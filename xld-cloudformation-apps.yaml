apiVersion: xl-deploy/v1beta1
kind: Applications
spec:
- name: test-elton
  type: core.Directory
  children:

# Provision EKS cluster using Cloudformation templates
    - name: EKS-CLOUDFORMATION
      type: core.Directory
      children:
      - name: test-elton-cloudformation-eks-user
        type: udm.Application
        children:
        - name: '1.0.0'
          type: udm.DeploymentPackage
          deployables:
          - name: test-elton-eks-user
            type: aws.cloudformation.Template
            file: !file cloudformation/eks-user.yaml
            capabilities:
            - CAPABILITY_IAM
            - CAPABILITY_NAMED_IAM
            inputVariables:
              ProjectName: test-elton
              UserStackName: test-elton-eks-user
      - name: test-elton-cloudformation-eks-vpc
        type: udm.Application
        children:
        - name: '1.0.0'
          type: udm.DeploymentPackage
          deployables:
          - name: test-elton-eks-vpc
            type: aws.cloudformation.Template
            file: !file cloudformation/eks-vpc.yaml
            capabilities:
            - CAPABILITY_IAM
            - CAPABILITY_NAMED_IAM
            inputVariables:
              ProjectName: test-elton
              VPCStackName: test-elton-eks-vpc
              AvailabilityZones: us-east-1a, us-east-1b
      - name: test-elton-cloudformation-eks-master
        type: udm.Application
        children:
        - name: '1.0.0'
          type: udm.DeploymentPackage
          deployables:
          - name: test-elton-eks-master
            type: aws.cloudformation.Template
            file: !file cloudformation/eks-master.yaml
            capabilities:
            - CAPABILITY_IAM
            - CAPABILITY_NAMED_IAM
            inputVariables:
              ProjectName: test-elton
              VPCStackName: test-elton-eks-vpc
      - name: test-elton-cloudformation-eks-workers
        type: udm.Application
        children:
        - name: '1.0.0'
          type: udm.DeploymentPackage
          deployables:
          - name: test-elton-eks-workers
            type: aws.cloudformation.Template
            file: !file cloudformation/eks-workers.yaml
            capabilities:
            - CAPABILITY_IAM
            - CAPABILITY_NAMED_IAM
            inputVariables:
              ProjectName: test-elton
              VPCStackName: test-elton-eks-vpc
              UserStackName: test-elton-eks-user
              ClusterStackName: test-elton-eks-master
              ClusterName: test-elton-master
              NodeGroupName: test-elton
      - name: test-elton-k8s-configmap
        type: udm.Application
        children:
        - name: '1.0.0'
          type: udm.DeploymentPackage
          deployables:
          - name: test-elton-aws-auth
            type: k8s.ResourcesFile
            file: !file kubernetes/aws-auth-cm.yaml
            delimiters: "## ##"

    - name: K8S
      type: core.Directory

# Provision K8s namespace
      children:
      - name: test-elton-namespace
        type: udm.Application
        children:
        - name: '1.0.0'
          type: udm.DeploymentPackage
          deployables:
          - name: xl-demo
            type: k8s.NamespaceSpec
            namespaceName: 'xl-demo'